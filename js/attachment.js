jQuery(document).ready(function($) {    var AUIU_Attachment = {        init: function () {            window.auiuFileCount = typeof window.auiuFileCount == 'undefined' ? 0 : window.auiuFileCount;            this.maxFiles = parseInt(auiu_attachment.number);            $('#auiu-attachment-upload-filelist').on('click', 'a.track-delete', this.removeTrack);            $('#auiu-attachment-upload-filelist ul.auiu-attachment-list').sortable({                cursor: 'crosshair',                handle: '.handle'            });            this.attachUploader();            this.hideUploadBtn();        },        hideUploadBtn: function () {            if(WPUF_Attachment.maxFiles !== 0 && window.auiuFileCount >= WPUF_Attachment.maxFiles) {                $('#auiu-attachment-upload-pickfiles').hide();            }        },        attachUploader: function() {            if(typeof plupload === 'undefined') {                return;            }            if(auiu_attachment.attachment_enabled !== '1') {                return            }            var attachUploader = new plupload.Uploader(auiu_attachment.plupload);            $('#auiu-attachment-upload-pickfiles').click(function(e) {                attachUploader.start();                e.preventDefault();            });            attachUploader.init();            attachUploader.bind('FilesAdded', function(up, files) {                $.each(files, function(i, file) {                    $('#auiu-attachment-upload-filelist').append(                        '<div id="' + file.id + '">' +                        file.name + ' (' + plupload.formatSize(file.size) + ') <b></b>' +                        '</div>');                });                up.refresh(); // Reposition Flash/Silverlight                attachUploader.start();            });            attachUploader.bind('UploadProgress', function(up, file) {                $('#' + file.id + " b").html(file.percent + "%");            });            attachUploader.bind('Error', function(up, err) {                $('#auiu-attachment-upload-filelist').append("<div>Error: " + err.code +                    ", Message: " + err.message +                    (err.file ? ", File: " + err.file.name : "") +                    "</div>"                    );                up.refresh(); // Reposition Flash/Silverlight            });            attachUploader.bind('FileUploaded', function(up, file, response) {                var resp = $.parseJSON(response.response);                $('#' + file.id).remove();                //console.log(resp);                if( resp.success ) {                    window.auiuFileCount += 1;                    $('#auiu-attachment-upload-filelist ul').append(resp.html);                    WPUF_Attachment.hideUploadBtn();                }            });        },        removeTrack: function(e) {            e.preventDefault();            if(confirm(auiu.confirmMsg)) {                var el = $(this),                data = {                    'attach_id' : el.data('attach_id'),                    'nonce' : auiu_attachment.nonce,                    'action' : 'auiu_attach_del'                };                $.post(auiu.ajaxurl, data, function(){                    el.parent().parent().remove();                    window.auiuFileCount -= 1;                    if(WPUF_Attachment.maxFiles !== 0 && window.auiuFileCount < WPUF_Attachment.maxFiles ) {                        $('#auiu-attachment-upload-pickfiles').show();                    }                });            }        }    };    //run the bootstrap    WPUF_Attachment.init();});